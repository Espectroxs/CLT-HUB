-- ESPECTROXS UI Library (updated)
-- Usage: Place this ModuleScript in ReplicatedStorage (or host it remotely and loadstring it),
-- and require it from a LocalScript running on the client (StarterPlayerScripts / StarterGui).
-- Example:
-- local Library = require(path_to_this_module)
-- local winData, winGui = Library:AddWindow("Title", { main_color = Color3.fromRGB(41,74,122) })
-- local leftTab, leftFrame = winData:AddTab("Left", "Farm")
-- leftTab:AddButton("Start", function() print("start") end)
-- Features:
-- - Tabs on left and right sides (call AddTab("Left", name) or AddTab("Right", name"))
-- - Minimize / restore toggle in title bar
-- - Resizable (client-side) with minimum size
-- - Common UI components: AddLabel, AddButton, AddSwitch, AddSlider, AddDropdown, AddColorPicker, AddKeybind
-- - Parent ScreenGui to PlayerGui (safe for LocalScript)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local DEFAULTS = {
	main_color = Color3.fromRGB(41, 74, 122),
	min_size = Vector2.new(400, 300),
	toggle_key = Enum.KeyCode.RightShift,
	can_resize = true,
	tween_time = 0.12,
}

local function clamp255(n)
	n = tonumber(n) or 0
	if n < 0 then return 0 end
	if n > 255 then return 255 end
	return n
end

local function normalize_color(c)
	if typeof(c) == "Color3" then return c end
	if type(c) == "table" and #c >= 3 then
		return Color3.fromRGB(clamp255(c[1]), clamp255(c[2]), clamp255(c[3]))
	end
	return DEFAULTS.main_color
end

-- Ensure LocalPlayer / PlayerGui (Module should be required from a client LocalScript)
local LocalPlayer = Players.LocalPlayer
if not LocalPlayer then
	-- try waiting (in case required too early); this will only work if required in a context that can wait
	repeat
		Players:GetPropertyChangedSignal("LocalPlayer"):Wait()
		LocalPlayer = Players.LocalPlayer
	until LocalPlayer
end
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Destroy any older GUI with same name
local EXISTING = PlayerGui:FindFirstChild("ESPECTROXS_imgui")
if EXISTING then
	EXISTING:Destroy()
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ESPECTROXS_imgui"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

local library = {}
local windowsCount = 0

local function tween(inst, props, t)
	t = t or DEFAULTS.tween_time
	local info = TweenService:Create(inst, TweenInfo.new(t, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
	info:Play()
	return info
end

local function new(class, props)
	local inst = Instance.new(class)
	if props then
		for k, v in pairs(props) do
			-- protected assignment for read-only properties
			pcall(function() inst[k] = v end)
		end
	end
	return inst
end

-- Toggle GUI visibility with key
do
	local visible = true
	UserInputService.InputBegan:Connect(function(input, gp)
		if gp then return end
		if input.KeyCode == DEFAULTS.toggle_key then
			visible = not visible
			screenGui.Enabled = visible
		end
	end)
end

function library:AddWindow(title, options)
	title = tostring(title or "New Window")
	options = (type(options) == "table") and options or {}
	local opts = {}
	for k, v in pairs(DEFAULTS) do
		opts[k] = (options[k] ~= nil) and options[k] or v
	end
	opts.main_color = normalize_color(opts.main_color)
	windowsCount = windowsCount + 1
	local zIndexBase = 10 + windowsCount * 10

	-- Window root
	local Window = new("Frame", {
		Name = "ESPECTROXS_Window_" .. tostring(windowsCount),
		Parent = screenGui,
		BackgroundColor3 = Color3.fromRGB(30, 30, 30),
		BorderSizePixel = 0,
		Size = UDim2.new(0, opts.min_size.X, 0, opts.min_size.Y),
		Position = UDim2.new(0.25, 0, 0.15, 0),
		ZIndex = zIndexBase,
	})
	new("UICorner", { Parent = Window, CornerRadius = UDim.new(0, 8) })

	-- Title bar
	local TitleBar = new("Frame", {
		Parent = Window,
		BackgroundColor3 = opts.main_color,
		Size = UDim2.new(1, 0, 0, 28),
		Position = UDim2.new(0, 0, 0, 0),
		ZIndex = zIndexBase + 1,
	})
	new("UICorner", { Parent = TitleBar, CornerRadius = UDim.new(0, 8) })
	local TitleLabel = new("TextLabel", {
		Parent = TitleBar,
		BackgroundTransparency = 1,
		Text = title,
		Font = Enum.Font.GothamBold,
		TextSize = 14,
		TextColor3 = Color3.new(1, 1, 1),
		TextXAlignment = Enum.TextXAlignment.Left,
		Position = UDim2.new(0, 10, 0, 0),
		Size = UDim2.new(1, -80, 1, 0),
		ZIndex = zIndexBase + 2,
	})

	-- Minimize toggle button
	local MinimizeBtn = new("TextButton", {
		Parent = TitleBar,
		BackgroundTransparency = 1,
		Text = "-",
		Font = Enum.Font.GothamBold,
		TextSize = 20,
		TextColor3 = Color3.new(1, 1, 1),
		Size = UDim2.new(0, 28, 0, 28),
		Position = UDim2.new(1, -34, 0, 0),
		ZIndex = zIndexBase + 3,
	})
	MinimizeBtn.MouseEnter:Connect(function() MinimizeBtn.TextColor3 = Color3.new(0.9,0.9,0.9) end)
	MinimizeBtn.MouseLeave:Connect(function() MinimizeBtn.TextColor3 = Color3.new(1,1,1) end)

	-- Close button (optional small X)
	local CloseBtn = new("TextButton", {
		Parent = TitleBar,
		BackgroundTransparency = 1,
		Text = "×",
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextColor3 = Color3.new(1, 1, 1),
		Size = UDim2.new(0, 28, 0, 28),
		Position = UDim2.new(1, -60, 0, 0),
		ZIndex = zIndexBase + 3,
	})
	CloseBtn.MouseButton1Click:Connect(function()
		Window:Destroy()
	end)

	-- Left and Right Tabs containers
	local LeftTabs = new("Frame", {
		Parent = Window,
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 120, 1, -70),
		Position = UDim2.new(0, 10, 0, 36),
		ZIndex = zIndexBase + 1,
	})
	new("UIListLayout", { Parent = LeftTabs, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 6) })

	local RightTabs = new("Frame", {
		Parent = Window,
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 120, 1, -70),
		Position = UDim2.new(1, -130, 0, 36),
		ZIndex = zIndexBase + 1,
	})
	new("UIListLayout", { Parent = RightTabs, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 6) })

	-- Central content area
	local ContentArea = new("Frame", {
		Parent = Window,
		BackgroundColor3 = Color3.fromRGB(20, 20, 20),
		Size = UDim2.new(1, -260 - 20, 1, -96),
		Position = UDim2.new(0, 140, 0, 36),
		ZIndex = zIndexBase + 1,
	})
	new("UICorner", { Parent = ContentArea, CornerRadius = UDim.new(0, 6) })
	local ContentLayout = new("UIListLayout", { Parent = ContentArea, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 6) })
	ContentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	new("UIPadding", { Parent = ContentArea, PaddingLeft = UDim.new(0, 8), PaddingTop = UDim.new(0, 8) })

	-- Footer (creator name)
	local Footer = new("Frame", {
		Parent = Window,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 28),
		Position = UDim2.new(0, 0, 1, -28),
		ZIndex = zIndexBase + 1,
	})
	new("TextLabel", {
		Parent = Footer,
		BackgroundTransparency = 1,
		Text = "ESPECTROXS",
		Font = Enum.Font.GothamBold,
		TextSize = 13,
		TextColor3 = opts.main_color,
		Size = UDim2.new(1, -12, 1, 0),
		Position = UDim2.new(0, 8, 0, 0),
		TextXAlignment = Enum.TextXAlignment.Right,
		ZIndex = zIndexBase + 2,
	})

	-- Resizer (bottom-right)
	local Resizer = new("ImageButton", {
		Parent = Window,
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 16, 0, 16),
		Position = UDim2.new(1, -20, 1, -20),
		ZIndex = zIndexBase + 4,
		Image = "rbxassetid://2851929490",
		ImageColor3 = Color3.fromRGB(50, 50, 50),
		AutoButtonColor = false,
	})
	new("UICorner", { Parent = Resizer, CornerRadius = UDim.new(0, 4) })

	-- Draggable
	Window.Active = true
	Window.Draggable = true

	-- Resizing behavior
	do
		local dragging = false
		local mouse = LocalPlayer:GetMouse()
		Resizer.MouseButton1Down:Connect(function()
			if not opts.can_resize then return end
			dragging = true
			Window.Draggable = false
		end)
		UserInputService.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragging = false
				Window.Draggable = true
			end
		end)
		RunService.Heartbeat:Connect(function()
			if dragging and opts.can_resize then
				local mpos = UserInputService:GetMouseLocation()
				local topLeft = Window.AbsolutePosition
				local newW = math.max(opts.min_size.X, mpos.X - topLeft.X)
				local newH = math.max(opts.min_size.Y, mpos.Y - topLeft.Y)
				Window.Size = UDim2.new(0, newW, 0, newH)
			end
		end)
	end

	-- Minimize behavior
	local minimized = false
	local prevSize = Window.Size
	MinimizeBtn.MouseButton1Click:Connect(function()
		minimized = not minimized
		if minimized then
			prevSize = Window.Size
			tween(ContentArea, {Size = UDim2.new(ContentArea.Size.X.Scale, ContentArea.Size.X.Offset, 0, 0)}, 0.12)
			-- hide left/right tabs content
			for _, c in ipairs(LeftTabs:GetChildren()) do if c:IsA("TextButton") then c.Visible = false end end
			for _, c in ipairs(RightTabs:GetChildren()) do if c:IsA("TextButton") then c.Visible = false end end
			tween(Window, {Size = UDim2.new(Window.Size.X.Scale, Window.Size.X.Offset, 0, 28)}, 0.12)
			MinimizeBtn.Text = "+"
		else
			tween(Window, {Size = prevSize}, 0.12)
			MinimizeBtn.Text = "-"
			-- restore tab buttons
			for _, c in ipairs(LeftTabs:GetChildren()) do if c:IsA("TextButton") then c.Visible = true end end
			for _, c in ipairs(RightTabs:GetChildren()) do if c:IsA("TextButton") then c.Visible = true end end
			-- small delay to allow window size change
			delay(0.12, function()
				-- no-op; content area will auto-size with children
			end)
		end
	end)

	-- Keep track of added tabs and active content
	local window_data = { _leftTabs = {}, _rightTabs = {}, _active = nil }

	local function showTabContent(frame)
		for _, child in ipairs(ContentArea:GetChildren()) do
			if child:IsA("Frame") and child.Name:sub(1,4) == "Tab_" then
				child.Visible = false
			end
		end
		if frame and frame.Parent == ContentArea then
			frame.Visible = true
			window_data._active = frame
		end
	end

	-- AddTab API: AddTab(side, name)
	function window_data:AddTab(side, tab_name)
		side = tostring((side or "Left"))
		tab_name = tostring(tab_name or "Tab")
		local sideNormalized = (string.lower(side) == "right") and "Right" or "Left"

		-- button on side
		local parentTabs = (sideNormalized == "Right") and RightTabs or LeftTabs
		local btn = new("TextButton", {
			Parent = parentTabs,
			BackgroundColor3 = Color3.fromRGB(40,40,40),
			BorderSizePixel = 0,
			Text = tab_name,
			Font = Enum.Font.GothamSemibold,
			TextSize = 14,
			TextColor3 = Color3.fromRGB(230,230,230),
			Size = UDim2.new(1, -6, 0, 30),
			ZIndex = zIndexBase + 2,
		})
		new("UICorner", { Parent = btn, CornerRadius = UDim.new(0, 6) })

		-- content frame for the tab
		local content = new("Frame", {
			Parent = ContentArea,
			Name = "Tab_" .. tab_name,
			BackgroundTransparency = 1,
			AutomaticSize = Enum.AutomaticSize.Y,
			Size = UDim2.new(1, -12, 0, 0),
			Position = UDim2.new(0, 6, 0, 0),
			Visible = false,
			ZIndex = zIndexBase + 1,
		})
		new("UIListLayout", { Parent = content, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 6) })
		new("UIPadding", { Parent = content, PaddingLeft = UDim.new(0, 6), PaddingTop = UDim.new(0, 6), PaddingBottom = UDim.new(0, 6) })

		-- button behavior
		btn.MouseButton1Click:Connect(function()
			showTabContent(content)
			-- visual: reset siblings then highlight clicked
			for _, s in ipairs(parentTabs:GetChildren()) do
				if s:IsA("TextButton") then s.BackgroundColor3 = Color3.fromRGB(40,40,40) end
			end
			btn.BackgroundColor3 = opts.main_color
		end)

		-- expose API for adding controls
		local tab_api = {}

		function tab_api:AddLabel(text)
			local t = tostring(text or "")
			local label = new("TextLabel", {
				Parent = content,
				BackgroundTransparency = 1,
				Text = t,
				Font = Enum.Font.Gotham,
				TextSize = 14,
				TextColor3 = Color3.fromRGB(230,230,230),
				Size = UDim2.new(1, -12, 0, 18),
				TextXAlignment = Enum.TextXAlignment.Left,
			})
			return label
		end

		function tab_api:AddButton(text, callback)
			local txt = tostring(text or "Button")
			callback = (type(callback) == "function") and callback or function() end
			local btnf = new("TextButton", {
				Parent = content,
				BackgroundColor3 = opts.main_color,
				Text = txt,
				Font = Enum.Font.GothamSemibold,
				TextSize = 14,
				TextColor3 = Color3.new(1,1,1),
				Size = UDim2.new(0.6, 0, 0, 32),
				BorderSizePixel = 0,
			})
			new("UICorner", { Parent = btnf, CornerRadius = UDim.new(0, 6) })
			btnf.MouseButton1Click:Connect(function()
				pcall(callback)
			end)
			return btnf
		end

		function tab_api:AddSwitch(text, callback)
			text = tostring(text or "Switch")
			callback = (type(callback) == "function") and callback or function() end
			local container = new("Frame", { Parent = content, BackgroundTransparency = 1, Size = UDim2.new(1, -12, 0, 28) })
			local lbl = new("TextLabel", { Parent = container, BackgroundTransparency = 1, Text = text, Font = Enum.Font.Gotham, TextSize = 14, TextColor3 = Color3.fromRGB(230,230,230), Size = UDim2.new(0.7, 0, 1, 0), TextXAlignment = Enum.TextXAlignment.Left })
			local sw = new("TextButton", { Parent = container, BackgroundColor3 = Color3.fromRGB(60,60,60), Size = UDim2.new(0, 52, 0, 20), Position = UDim2.new(1, -60, 0, 4), Text = "", BorderSizePixel = 0 })
			new("UICorner", { Parent = sw, CornerRadius = UDim.new(1,0) })
			local dot = new("Frame", { Parent = sw, BackgroundColor3 = Color3.new(1,1,1), Size = UDim2.new(0, 10, 0, 10), Position = UDim2.new(0, 4, 0, 5) })
			new("UICorner", { Parent = dot, CornerRadius = UDim.new(1,0) })
			local toggled = false
			local function update()
				if toggled then
					tween(sw, { BackgroundColor3 = opts.main_color }, 0.08)
					tween(dot, { Position = UDim2.new(1, -14, 0, 5) }, 0.08)
				else
					tween(sw, { BackgroundColor3 = Color3.fromRGB(60,60,60) }, 0.08)
					tween(dot, { Position = UDim2.new(0, 4, 0, 5) }, 0.08)
				end
				pcall(callback, toggled)
			end
			sw.MouseButton1Click:Connect(function()
				toggled = not toggled
				update()
			end)
			return {
				Set = function(b) toggled = not not b; update() end,
				Get = function() return toggled end,
			}
		end

		function tab_api:AddSlider(text, callback, slider_opts)
			text = tostring(text or "Slider")
			callback = (type(callback) == "function") and callback or function() end
			slider_opts = type(slider_opts) == "table" and slider_opts or {}
			local minv = tonumber(slider_opts.min) or 0
			local maxv = tonumber(slider_opts.max) or 100
			local readonly = slider_opts.readonly == true

			local container = new("Frame", { Parent = content, BackgroundTransparency = 1, Size = UDim2.new(1, -12, 0, 44) })
			new("TextLabel", { Parent = container, BackgroundTransparency = 1, Text = text, Font = Enum.Font.Gotham, TextSize = 14, TextColor3 = Color3.fromRGB(230,230,230), Size = UDim2.new(1, -70, 0, 18), TextXAlignment = Enum.TextXAlignment.Left })
			local valLabel = new("TextLabel", { Parent = container, BackgroundTransparency = 1, Text = tostring(minv), Font = Enum.Font.GothamBold, TextSize = 13, TextColor3 = Color3.fromRGB(230,230,230), Size = UDim2.new(0, 60, 0, 18), Position = UDim2.new(1, -60, 0, 0) })
			local bar = new("Frame", { Parent = container, BackgroundColor3 = Color3.fromRGB(50,50,50), Size = UDim2.new(1, -12, 0, 10), Position = UDim2.new(0, 6, 0, 26), BorderSizePixel = 0 })
			new("UICorner", { Parent = bar, CornerRadius = UDim.new(0, 6) })
			local fill = new("Frame", { Parent = bar, BackgroundColor3 = opts.main_color, Size = UDim2.new(0, 0, 1, 0) })
			new("UICorner", { Parent = fill, CornerRadius = UDim.new(0, 6) })

			local dragging = false
			bar.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 and not readonly then
					dragging = true
				end
			end)
			UserInputService.InputChanged:Connect(function(input)
				if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
					local rel = math.clamp((UserInputService:GetMouseLocation().X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
					fill.Size = UDim2.new(rel, 0, 1, 0)
					local v = math.floor(minv + (maxv - minv) * rel)
					valLabel.Text = tostring(v)
					pcall(callback, v)
				end
			end)
			UserInputService.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
			end)

			return {
				Set = function(v)
					local clamped = math.clamp(tonumber(v) or minv, minv, maxv)
					local rel = (clamped - minv) / math.max(1, (maxv - minv))
					fill.Size = UDim2.new(rel, 0, 1, 0)
					valLabel.Text = tostring(math.floor(clamped))
					pcall(callback, math.floor(clamped))
				end
			}
		end

		function tab_api:AddDropdown(text, callback, items)
			text = tostring(text or "Dropdown")
			callback = (type(callback) == "function") and callback or function() end
			items = type(items) == "table" and items or {}

			local dropdown = new("TextButton", {
				Parent = content,
				BackgroundColor3 = Color3.fromRGB(36,36,36),
				Text = "▾  " .. text,
				Font = Enum.Font.GothamBold,
				TextSize = 14,
				TextColor3 = Color3.fromRGB(230,230,230),
				Size = UDim2.new(0.6, 0, 0, 30),
				BorderSizePixel = 0,
			})
			new("UICorner", { Parent = dropdown, CornerRadius = UDim.new(0, 6) })

			local box = new("Frame", { Parent = content, BackgroundColor3 = Color3.fromRGB(26,26,26), Size = UDim2.new(0.6, 0, 0, 0), Visible = false })
			new("UICorner", { Parent = box, CornerRadius = UDim.new(0, 6) })
			local boxLayout = new("UIListLayout", { Parent = box, SortOrder = Enum.SortOrder.LayoutOrder })

			local open = false
			local function rebuild()
				for _, c in ipairs(box:GetChildren()) do if not c:IsA("UIListLayout") and not c:IsA("UICorner") then c:Destroy() end end
				local total = 0
				for _, it in ipairs(items) do
					local itBtn = new("TextButton", { Parent = box, BackgroundTransparency = 1, Text = "  " .. tostring(it), Font = Enum.Font.Gotham, TextSize = 14, TextColor3 = Color3.fromRGB(230,230,230), Size = UDim2.new(1, 0, 0, 26), BorderSizePixel = 0 })
					total = total + 26
					itBtn.MouseButton1Click:Connect(function()
						dropdown.Text = "▾  " .. text .. " [" .. tostring(it) .. "]"
						box.Visible = false
						open = false
						pcall(callback, it)
					end)
				end
				box.Size = UDim2.new(0.6, 0, 0, total)
			end
			rebuild()

			dropdown.MouseButton1Click:Connect(function()
				open = not open
				box.Visible = open
			end)

			return {
				Add = function(v) table.insert(items, v); rebuild() end,
				Remove = function(v)
					for i, it in ipairs(items) do if it == v then table.remove(items, i); break end end
					rebuild()
				end
			}
		end

		function tab_api:AddColorPicker(callback)
			callback = (type(callback) == "function") and callback or function() end
			local container = new("Frame", { Parent = content, BackgroundTransparency = 1, Size = UDim2.new(1, -12, 0, 72) })
			local palette = new("Frame", { Parent = container, BackgroundColor3 = Color3.fromRGB(255, 0, 0), Size = UDim2.new(0, 120, 0, 72), Position = UDim2.new(0, 6, 0, 0) })
			local sample = new("Frame", { Parent = container, BackgroundColor3 = Color3.fromRGB(255, 0, 0), Size = UDim2.new(0, 36, 0, 36), Position = UDim2.new(0, 132, 0, 6) })
			new("UICorner", { Parent = sample, CornerRadius = UDim.new(0, 6) })
			local hue = 0; local sat = 1; local val = 1
			local function update()
				local c = Color3.fromHSV(hue, sat, val)
				sample.BackgroundColor3 = c
				pcall(callback, c)
			end
			palette.InputBegan:Connect(function(inp)
				if inp.UserInputType == Enum.UserInputType.MouseButton1 then
					local loc = UserInputService:GetMouseLocation()
					local relX = math.clamp((loc.X - palette.AbsolutePosition.X) / palette.AbsoluteSize.X, 0, 1)
					local relY = math.clamp((loc.Y - palette.AbsolutePosition.Y) / palette.AbsoluteSize.Y, 0, 1)
					hue = relX
					sat = 1 - relY
					update()
				end
			end)
			return { Set = function(c) if typeof(c) == "Color3" then hue, sat, val = Color3.toHSV(c); update() end end }
		end

		function tab_api:AddKeybind(name, callback, defaultKey)
			name = tostring(name or "Keybind")
			callback = (type(callback) == "function") and callback or function() end
			defaultKey = defaultKey or Enum.KeyCode.RightShift
			local container = new("Frame", { Parent = content, BackgroundTransparency = 1, Size = UDim2.new(1, -12, 0, 28) })
			new("TextLabel", { Parent = container, BackgroundTransparency = 1, Text = name, Font = Enum.Font.Gotham, TextColor3 = Color3.fromRGB(230,230,230), TextSize = 14, Size = UDim2.new(0.7, 0, 1, 0), TextXAlignment = Enum.TextXAlignment.Left })
			local keyBtn = new("TextButton", { Parent = container, BackgroundColor3 = Color3.fromRGB(36,36,36), Text = tostring(defaultKey.Name), Font = Enum.Font.GothamBold, TextSize = 13, TextColor3 = Color3.fromRGB(230,230,230), Size = UDim2.new(0, 120, 0, 24), Position = UDim2.new(1, -126, 0, 2), BorderSizePixel = 0 })
			new("UICorner", { Parent = keyBtn, CornerRadius = UDim.new(0, 6) })

			local boundKey = defaultKey
			keyBtn.MouseButton1Click:Connect(function()
				keyBtn.Text = "Press a key..."
				local a, b = UserInputService.InputBegan:Wait()
				if a and a.KeyCode then
					boundKey = a.KeyCode
					keyBtn.Text = tostring(boundKey.Name)
				else
					keyBtn.Text = tostring(boundKey.Name)
				end
			end)
			UserInputService.InputBegan:Connect(function(inp, gp)
				if gp then return end
				if inp.KeyCode == boundKey then
					pcall(callback, boundKey)
				end
			end)
			return { Set = function(k) if typeof(k) == "EnumItem" then boundKey = k; keyBtn.Text = tostring(k.Name) end end }
		end

		-- convenience: show method for API
		function tab_api:Show()
			showTabContent(content)
			-- highlight button
			for _, b in ipairs(parentTabs:GetChildren()) do if b:IsA("TextButton") then b.BackgroundColor3 = Color3.fromRGB(40,40,40) end end
			btn.BackgroundColor3 = opts.main_color
		end

		-- store
		if sideNormalized == "Right" then
			table.insert(window_data._rightTabs, { button = btn, content = content, api = tab_api })
		else
			table.insert(window_data._leftTabs, { button = btn, content = content, api = tab_api })
		end

		-- if first tab: auto-show
		if not window_data._active then
			tab_api:Show()
		end

		return tab_api, content
	end

	-- return window data and the Window GUI root for advanced usage
	return window_data, Window
end

return library
